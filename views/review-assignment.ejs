<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Review Assignment</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Segoe UI",sans-serif;
  background:#f4f6fb;
  padding:20px;
}

.container{
  max-width:1000px;
  margin:auto;
  background:white;
  padding:24px;
  border-radius:12px;
}

.meta p{
  margin:6px 0;
}

iframe{
  width:100%;
  height:420px;
  border:1px solid #ddd;
  margin-top:10px;
}

.download-btn{
  display:inline-block;
  margin-top:12px;
  padding:10px 18px;
  background:#4b6cb7;
  color:white;
  text-decoration:none;
  border-radius:6px;
  font-weight:700;
}

textarea{
  width:100%;
  min-height:120px;
  margin-top:8px;
  padding:10px;
  resize:vertical;
}

.actions{
  display:flex;
  gap:16px;
  margin-top:20px;
}

.approve{
  background:#28a745;
  color:white;
  padding:12px 20px;
  border:none;
  border-radius:6px;
  font-weight:700;
  cursor:pointer;
}

.reject{
  background:#dc3545;
  color:white;
  padding:12px 20px;
  border:none;
  border-radius:6px;
  font-weight:700;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="container">
  <h2>Review Assignment</h2>

  <div class="meta">
    <p><b>Student:</b> <%= assignment.user.name %></p>
    <p><b>Title:</b> <%= assignment.title %></p>
    <p><b>Submitted On:</b>
      <%= new Date(assignment.submittedAt).toLocaleDateString() %>
    </p>
  </div>

  <h3>Assignment File</h3>

  <!-- Preview -->
  <iframe src="/uploads/<%= assignment.file.filename %>"></iframe>

  <!-- Proper Download Button -->
  <a class="download-btn"
     href="/uploads/<%= assignment.file.filename %>"
     download>
     ⬇ Download Assignment
  </a>

  <h3 style="margin-top:24px;">Remarks (Max 300 words)</h3>
  <textarea id="remarks"
    maxlength="1800"
    placeholder="Enter remarks for the student (max 300 words)"></textarea>

  <div class="actions">
    <button class="approve"
      onclick="submitDecision('Approved')">
      ✓ Approve Assignment
    </button>

    <button class="reject"
      onclick="submitDecision('Rejected')">
      ✗ Reject Assignment
    </button>
  </div>
</div>

<script>
function submitDecision(status){
  const remarks =
    document.getElementById("remarks").value.trim();

  if(remarks.split(/\s+/).length > 300){
    alert("Remarks must be within 300 words");
    return;
  }

  fetch("/professor/assignments/<%= assignment._id %>/decision", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ status, remarks })
  })
  .then(res => res.json())
  .then(data => {
    alert(data.message);
    window.location.href = "/professor/dashboard";
  });
}
</script>

</body>
</html>
