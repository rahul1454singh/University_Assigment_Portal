<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Review Assignment</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Segoe UI",sans-serif;
  background:#f4f6fb;
  padding:20px;
  min-height:100vh;
}

.container{
  max-width:1000px;
  margin:auto;
  background:white;
  padding:24px;
  border-radius:12px;
}

.meta p{
  margin:6px 0;
  font-size:14px;
}

iframe{
  width:100%;
  height:420px;
  border:1px solid #ddd;
  margin-top:10px;
  border-radius:8px;
}

.download-btn{
  display:inline-block;
  margin-top:12px;
  padding:10px 18px;
  background:#4b6cb7;
  color:white;
  text-decoration:none;
  border-radius:6px;
  font-weight:700;
  font-size:14px;
}

textarea{
  width:100%;
  min-height:120px;
  margin-top:8px;
  padding:10px;
  resize:vertical;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:14px;
}

.actions{
  display:flex;
  gap:16px;
  margin-top:20px;
  flex-wrap:wrap;
}

.approve{
  background:#28a745;
  color:white;
  padding:12px 20px;
  border:none;
  border-radius:6px;
  font-weight:700;
  cursor:pointer;
  font-size:14px;
}

.reject{
  background:#dc3545;
  color:white;
  padding:12px 20px;
  border:none;
  border-radius:6px;
  font-weight:700;
  cursor:pointer;
  font-size:14px;
}

/* =====================
   TABLET & MOBILE
===================== */
@media (max-width: 768px){
  .container{
    padding:18px;
  }

  iframe{
    height:320px;
  }

  .actions{
    gap:12px;
  }
}

/* =====================
   MOBILE
===================== */
@media (max-width: 480px){
  body{
    padding:12px;
  }

  .container{
    padding:14px;
  }

  iframe{
    height:240px;
  }

  textarea{
    font-size:13px;
    padding:9px;
  }

  .approve,
  .reject{
    width:100%;
    padding:12px;
    font-size:14px;
  }

  .download-btn{
    width:100%;
    text-align:center;
    padding:12px;
  }
}
</style>
</head>

<body>

<div class="container">
  <h2>Review Assignment</h2>

  <div class="meta">
    <p><b>Student:</b> <%= assignment.user.name %></p>
    <p><b>Title:</b> <%= assignment.title %></p>
    <p><b>Submitted On:</b>
      <%= new Date(assignment.submittedAt).toLocaleDateString() %>
    </p>
  </div>

  <h3>Assignment File</h3>

  <iframe src="/uploads/<%= assignment.file.filename %>"></iframe>

  <a class="download-btn"
     href="/uploads/<%= assignment.file.filename %>"
     download>
     ⬇ Download Assignment
  </a>

  <h3 style="margin-top:24px;">Remarks (Max 300 words)</h3>
  <textarea id="remarks"
    maxlength="1800"
    placeholder="Enter remarks for the student (max 300 words)"></textarea>

  <div class="actions">
    <button type="button" class="approve"
      onclick="submitDecision('Approved')">
      ✓ Approve Assignment
    </button>

    <button type="button" class="reject"
      onclick="submitDecision('Rejected')">
      ✗ Reject Assignment
    </button>
  </div>
</div>

<script>
function submitDecision(status){
  const remarks = document.getElementById("remarks").value.trim();

  if(remarks.split(/\s+/).length > 300){
    alert("Remarks must be within 300 words");
    return;
  }

  fetch("/professor/assignments/<%= assignment._id %>/decision", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    credentials: "same-origin",
    body: JSON.stringify({ status, remarks })
  })
  .then(async res => {
    const text = await res.text();
    try {
      return JSON.parse(text);
    } catch {
      throw new Error("Server error: " + text);
    }
  })
  .then(data => {
    alert(data.message || "Decision saved successfully");
    window.location.href = "/professor/dashboard";
  })
  .catch(err => {
    console.error(err);
    alert("Something went wrong. Check console / server logs.");
  });
}
</script>

</body>
</html>
